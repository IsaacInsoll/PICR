name: picr-test
services:
  test-picr:
    container_name: test-picr
    build: ..
    volumes:
      - ./env/media:/home/node/app/media:ro
    # intentionally leaving the cache inside the container as we can't write to the host when running in docker ?
#      - ./env/cache:/home/node/app/cache
    depends_on:
      - test-db
    ports:
      - "6901:6900"
    environment:
      - TOKEN_SECRET=15bba1733b6684f53275e7c6ba6cf2efd68b697a9da6d6954c92c72dfd471585857bed975306f3f00172fffec0027b50e0f2d37e8d0a2f00af3c7e36aa710504
      - DATABASE_URL=postgres://user:pass@test-db/picr
      - USE_POLLING=true
      - POLLING_INTERVAL=100
      - BASE_URL=http://localhost:6901/
  test-db:
    container_name: test-db
    ports:
      - "54313:5432"
    image: postgres:16
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: picr
    volumes:
      - type: tmpfs
        target: /var/lib/postgresql/data